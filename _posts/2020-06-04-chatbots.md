---
layout: post
title: Chatbots
tags:
- chatbots
- python
toc: true
---

## Motivation

[On the Subject of Talent](https://drawabox.com/article/talent) - this is originally for artists, but I believe it applies to programmers really well too.


## Tools
 - Replit Account - This is where we will be hosting the bot and programming it.
 - Discord Test Server - To test our bot and its various commands

## Setup

### Replit Setup
We'll be using replit.com to code our discord bot. This is an IDE that is built into the browser, so it will allow us to create our bot without having to host it on our PC.

To start, make an account and create a new python project in Replit. Next, click on **main.py** and type the following on the first line:
```python
from discord.ext import commands
```
This command will allow us to utilize the **discord.py** library and create our bot. 
### Grabbing the Token
If you haven't created an account on Discord, do that first. Then, once you have an account we need to make a test server. This is where we will invite the bot and test out its commands.

To begin setting up your bot, go to this page:
[Discord Developer Page](https://discord.com/developers/applications) and click on "new application"
Then, follow these steps: 
- Go to bot page and click ‘Add Bot’
- Scroll down to ‘TOKEN’ and click on copy. This is the bot’s password we use to login into it.
- Be careful to NEVER share the token, someone can pretend to be your bot
- Go to the secrets panel 
- Create a key called password and paste your token there
- Make sure to never make it public - or else your token might get stolen
- At the top of your program, add the following:

```python
import os
bot = commands.Bot(command_prefix='!')
password = os.environ['password']
bot.run(password)
```
This will allow your bot to access the token and run.

### Bot Permissions
Now we will give our bot permissions to be able to carry out the commands we create for it.
- Go back to the Discord Developers page 
- Under ‘OAuth2 URL Generator’, go to ‘Scopes’ and select the ‘bot’ checkbox.
- Now, we have to figure out the list of permissions for our bot. For your actual bot, I highly suggest taking the time to understand this so you can give it the permissions you need, but for the workshop, check off **'Read messages/View Channels'** and **‘Send Messages’**.

### Adding Bot to Server
Based on what you checked off, the invite URL should have updated. Hit ‘Copy’ and paste it in a new tab on your browser. 

The page will ask you which server to add the bot, and you should pick your test server that we created earlier.
- Be careful where you’re adding it!

## Workshop
### First Task : Hello World
Let’s start off with a simple !hello command that will say hello to the user calling it!
This command will use **ctx** that is taken in from the command and use it to get the name of the user. This will also familiarize you with with the basic structure of a command and string manipulation.

First we will have our bot give the traditional programming greeting of ‘hello world!’. 

Add this snippet of code under the line that says `bot = commands.Bot(command_prefix=’!')`

```python
@bot.command()
async def hello(ctx):
    await ctx.send("hello world!")
```
Now run your bot and test it out in your discord test server. Isn’t that cool? The "async" before the function header lets our program deal with stuff that may take a while to run. It lets other commands run while it is running, so we wait around more efficiently.

Now we will make this command a bit more in depth to have it greet the user that called the command!

In the definition of hello that we just wrote, change it so that it matches this snippet of code:

```python
@bot.command()
async def hello(ctx):
    await ctx.send("hello " + ctx.author.display_name)
```
Now run your bot and test it out in your discord test server. It should now display your username after the 'hello'!

### Second Task : Dog Videos
Next we will make a command to give us a randomly chosen dog video out of a list we will be making.


Add this line of code under the line ``bot = commands.Bot(command_prefix=’!’)``

```python
bot.videos = ['https://www.youtube.com/watch?v=V2qH7Rkzq24', 'https://www.youtube.com/watch?v=G92E3FWnHm0', 'https://www.youtube.com/watch?v=0DPZ9b9ZZr4']
```

This will be the list of dog videos we will be pulling from to send to the user. You can either use the links provided in our example list, or go on YouTube and find your own!

Also add this line of code under ``import os``

```python
import random
```

Random allows us to generate random numbers, which we will have our bot use to choose which dog video to send to us.

Add this snippet of code under the definition of hello that we previously wrote:

```python
@bot.command()
async def dog(ctx):
    await ctx.send(random.choice(bot.videos))
```

The command ``random.choice`` allows use to choose a random object from a list that we pass in. Here we are passing in ``bot.videos`` and our command is pulling out a random video to send to the user.


### Third Task : Happy and Sad
Let’s create a wholesome bot that makes people happy!

In this task we will create two commands: !happy and !sad
- !happy: Takes in an input of something that the user thinks makes them happy and stores it in a list.
- !sad: Takes a random item from that list and prints out that item.

First, we need a list to store our happy objects! Under ``bot.videos``, create a new variable and type ``bot.happylist = []``

For the happy command, add this snippet of code under our previous definition of the dog command:
```python
@bot.command()
async def happy(ctx, *, item):
    await ctx.send("Awesome!")
    bot.happylist.append(item)
    print(bot.happylist)
```

As you can see the header for our happy command is slightly different. The ``*`` allows us to type an input into the command and our input gets stored in the ``item`` variable to be used later. 

Then, our command gets the ``item`` variable that stored our input and ``appends`` it to our list, which is just another way of saying that its being added to the list. To help us keep track of the items in our list, the print statement in the function will print our current list into the console.


For the sad command, add this snippet of code under our definition for happy:
```python
@bot.command()
async def sad(ctx):
  await ctx.send("Hope this makes you feel better!")
  await ctx.send(random.choice(bot.happylist))
```

This command is more straightforward. We are getting all the happy things we added to the happylist and choosing a random one of them from our ``random.choice`` command.


### Fourth Task : Calculator
We’re now going to add the calc command, which enables us to do the four standard calculator operations.
This command will help us learn about collecting input and how to have branching accordingly.

Copy the following function:

```python
@bot.command()
async def calc(ctx, x, fn, y):
    x = float(x)
    y = float(y)
    if fn == '+':
        await ctx.send(x + y)
    elif fn == '-':
        await ctx.send(x - y)
    elif fn == '*':
        await ctx.send(x * y)
    elif fn == '/':
        await ctx.send(x / y)
    else:
        await ctx.send("We only support 4 function operations")
```
Notice that we had to add more parameters after `ctx`, as we are dealing with multiple inputs for our command. 

So if we restart our bot and ask it ``!calc 7 + 6`` it responds with 13.

This code can be shortened by having python automatically convert our numbers to floats. Currently everything is taken in as a string. In order to fix this, we can change our function heading and remove the conversion we wrote for x and y within our command’s definition. This is what the new function heading should look like:

```python
async def calc(ctx, x: float, fn: str, y: float):
```
So, now your command should look like this:

```python
@bot.command()
async def calc(ctx, x: float, fn: str, y: float):
    if fn == '+':
        await ctx.send(x + y)
    elif fn == '-':
        await ctx.send(x - y)
    elif fn == '*':
        await ctx.send(x * y)
    elif fn == '/':
        await ctx.send(x / y)
    else:
        await ctx.send("We only support 4 function operations")
```
And there you have it! You now have a custom discord bot that you can continue to add commands to and cusomize to your liking! You could also use your new knowledge to try adding more functionality to some of the above commands.

## Learn More About Chatbots

* [discord.py Documentation](https://discordpy.readthedocs.io/en/stable)

* [Real Python: How to Make a Discord Bot in Python](https://realpython.com/how-to-make-a-discord-bot-python/) - this is the most comprehensive tutorial

* [towards data science - How to build your own AI Chatbot on Discord?](https://towardsdatascience.com/how-to-build-your-own-ai-chatbot-on-discord-c6b3468189f4) - more advanced, but this shows how you can start mixing in AI with chatbots as well

## Learn More About Python Concepts 

* Decorators - [datacamp - decorators in python](https://www.datacamp.com/community/tutorials/decorators-python)

* Concurrency - [python docs asyncio](https://docs.python.org/3/library/asyncio-task.html) and [real python - async io](https://realpython.com/async-io-python/#the-10000-foot-view-of-async-io).

* Randomness - [realpython - Generating Random Data in Python (Guide)](https://realpython.com/python-random/).

* Types - [Using Python's Type Annotations](https://dev.to/dstarner/using-pythons-type-annotations-4cfe) and [mypy](https://dropbox.tech/application/our-journey-to-type-checking-4-million-lines-of-python).


Contributors: Nehal, Savannah, Harsh